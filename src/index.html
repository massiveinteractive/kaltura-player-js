<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1.0, user-scalable=no">
    <title>Title</title>
    <link rel="stylesheet" type="text/css" href="./style.css" />
    <script src="./kaltura-player.js" type="text/javascript"></script>
</head>

<body>
    <div id="player-placeholder"></div>
    <script>
        var mediaid = 315820;
        var externacaptionurl = "https://sub-stg.toggle.sg/toggle_api/v1.0/apiService/getSubtitleFilesForMedia?mediaId=" + mediaid.toString();

        var xhttp = new XMLHttpRequest();
        function getSubtitles() {
            return new Promise(resolve => {
                var extcaptions = [];
                xhttp.onreadystatechange = function (data, textStatus, jQxhr) {
                    if (xhttp.readyState === 4) {
                        const subtitleFiles = JSON.parse(xhttp.responseText).subtitleFiles;
                        for (var i = 0; i < subtitleFiles.length; i++) {
                            extcaptions.push({
                                "url": subtitleFiles[i].subtitleFileUrl,
                                "type": "srt",
                                "language": subtitleFiles[i].subtitleFileCode,
                                "label": subtitleFiles[i].subtitleFileLanguage
                            });

                        }
                        resolve(extcaptions);
                    }
                }
                xhttp.open("GET", externacaptionurl);
                xhttp.send();
            })
        }
        var mediaid = 318510;

        var kalturaPlayer;

        getSubtitles().then(extcaptions => {
            console.log(extcaptions)
            var playerConfig = {
                targetId: "player-placeholder",
                provider: {
                    partnerId: 147,
                    env: {
                        serviceUrl: 'https://rest-sgs1.ott.kaltura.com/api_v3',
                    }
                },
                sources: {
                    captions: extcaptions
                }
            };
            var mediaInfo = {
                entryId: mediaid,

            };
            try {
                kalturaPlayer = KalturaPlayer.setup(playerConfig);
                kalturaPlayer.loadMedia(mediaInfo);

                document.querySelector('.kaltura-player-container').appendChild(kalturaPlayer.getView());
            } catch (e) {
                console.error(e.message)
            }

        })
    </script>
</body>

</html>